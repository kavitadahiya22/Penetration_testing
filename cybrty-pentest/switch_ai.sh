#!/bin/bash
# AI Provider Toggle Script
# Usage: ./switch_ai.sh [ollama|openai] [model_name]

set -e

# Load environment variables from .env file
if [ -f .env ]; then
    export $(grep -v '^#' .env | xargs)
fi

# Function to switch to Ollama
switch_to_ollama() {
    local model=${1:-deepseek-coder}
    echo "ðŸ”„ Switching to Ollama with model: $model"
    export MODEL_PROVIDER=ollama
    export OLLAMA_MODEL=$model
    echo "âœ… Switched to Ollama ($model)"
}

# Function to switch to OpenAI
switch_to_openai() {
    local model=${1:-gpt-4-turbo-preview}
    echo "ðŸ”„ Switching to OpenAI with model: $model"
    export MODEL_PROVIDER=openai
    export OPENAI_MODEL=$model
    echo "âœ… Switched to OpenAI ($model)"
}

# Function to show current status
show_status() {
    echo "ðŸ“Š Current AI Provider Status:"
    ./venv/bin/python scripts/ai_manager.py status
}

# Function to test current provider
test_provider() {
    echo "ðŸ§ª Testing current AI provider:"
    ./venv/bin/python scripts/ai_manager.py test
}

# Main script logic
case "$1" in
    "ollama")
        switch_to_ollama "$2"
        show_status
        ;;
    "openai")
        switch_to_openai "$2"
        show_status
        ;;
    "status")
        show_status
        ;;
    "test")
        test_provider
        ;;
    *)
        echo "AI Provider Toggle Script"
        echo "========================"
        echo ""
        echo "Usage: $0 [command] [options]"
        echo ""
        echo "Commands:"
        echo "  ollama [model]    Switch to Ollama (default: deepseek-coder)"
        echo "  openai [model]    Switch to OpenAI (default: gpt-4-turbo-preview)"
        echo "  status           Show current provider status"
        echo "  test             Test current provider"
        echo ""
        echo "Examples:"
        echo "  $0 ollama                    # Switch to DeepSeek Coder"
        echo "  $0 ollama deepseek-r1:1.5b   # Switch to DeepSeek R1"
        echo "  $0 openai                    # Switch to GPT-4 Turbo"
        echo "  $0 openai gpt-3.5-turbo      # Switch to GPT-3.5"
        echo "  $0 status                    # Show current status"
        echo "  $0 test                      # Test current provider"
        echo ""
        echo "Available Ollama models:"
        echo "  - deepseek-coder (recommended for coding)"
        echo "  - deepseek-r1:1.5b (reasoning model)"
        echo ""
        echo "Available OpenAI models:"
        echo "  - gpt-4-turbo-preview (latest, most capable)"
        echo "  - gpt-4 (stable, high quality)"
        echo "  - gpt-3.5-turbo (fast, cost-effective)"
        ;;
esac
