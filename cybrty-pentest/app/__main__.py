"""Main application entry point."""

import uvicorn

from .api import router
from .core.config import get_settings


def create_app():
    """Create FastAPI application."""
    from fastapi import FastAPI
    
    settings = get_settings()
    
    app = FastAPI(
        title="Cybrty Pentest Service",
        description="Agentic pentesting service with AI-powered planning and execution",
        version="1.0.0",
        docs_url="/docs",
        redoc_url="/redoc"
    )
    
    # Include API router
    app.include_router(router)
    
    @app.get("/")
    async def root():
        """Root endpoint."""
        return {
            "message": "Cybrty Pentest Service",
            "version": "1.0.0",
            "docs": "/docs",
            "health": "/api/v1/healthz"
        }
    
    return app


def main():
    """Main entry point for running the application."""
    settings = get_settings()
    
    uvicorn.run(
        "app.__main__:create_app",
        factory=True,
        host=settings.server.host,
        port=settings.server.port,
        reload=False,
        log_level="info"
    )


if __name__ == "__main__":
    main()
